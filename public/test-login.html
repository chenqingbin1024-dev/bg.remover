<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>测试 Google 登录</title>
</head>
<body>
  <h1>Supabase Google 登录测试</h1>
  <button id="testBtn">测试登录</button>
  <div id="result"></div>

  <script>
    // 从服务器获取配置
    const SUPABASE_URL = '{{SUPABASE_URL}}';
    const SUPABASE_ANON_KEY = '{{SUPABASE_ANON_KEY}}';

    document.getElementById('testBtn').addEventListener('click', async () => {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p>测试中...</p>';

      // 检查配置
      if (!SUPABASE_URL || !SUPABASE_ANON_KEY || SUPABASE_URL.includes('{{') || SUPABASE_ANON_KEY.includes('{{')) {
        resultDiv.innerHTML = '<p style="color: red;">❌ 配置未设置！请在 .env 文件中设置 SUPABASE_URL 和 SUPABASE_ANON_KEY</p>';
        return;
      }

      try {
        // 动态导入 Supabase
        const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        resultDiv.innerHTML = '<p>✅ Supabase 客户端创建成功</p><p>正在跳转到 Google 登录...</p>';

        // 直接调用登录
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: `${window.location.origin}/auth/callback`,
          },
        });

        if (error) {
          resultDiv.innerHTML = `<p style="color: red;">❌ 错误: ${error.message}</p>`;
        } else if (data?.url) {
          resultDiv.innerHTML = `<p>✅ 成功！正在跳转...</p><p><a href="${data.url}">点击这里手动跳转</a></p>`;
          window.location.href = data.url;
        } else {
          resultDiv.innerHTML = '<p style="color: orange;">⚠️ 没有返回 URL，可能需要在 Supabase 控制台配置 Google OAuth</p>';
        }
      } catch (err) {
        resultDiv.innerHTML = `<p style="color: red;">❌ 异常: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>

